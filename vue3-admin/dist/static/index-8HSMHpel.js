import{g as H,d as j,u as O}from"./index-zyf2lgsb.js";import{y as Q,r as G,B as J,E as x,F as K}from"./element-Cx1u8HIB.js";import{u as W}from"./usePagination-DQcWKUV1.js";import{f as z}from"./index-DPHaodem.js";import{m as X,r as v,_ as Z,d as ee,ai as n,aq as N,p as c,q as ae,Q as w,O as m,P as a,V as e,u as s,T as p,t as D,U as I}from"./vue-BoURs06I.js";import{_ as te}from"./index-Bd4y8G8I.js";import"./vxe-OnfnC8YF.js";const oe={class:"app-container"},le={class:"table-wrapper"},ne={class:"pager-wrapper"},re=X({name:"UserManagement",__name:"index",setup(se){const _=v(!1),{paginationData:l,handleCurrentChange:P,handleSizeChange:U}=W(),L=r=>{J.confirm(`正在删除归还记录：${r.name}，确认删除？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{j(r.ser_num).then(()=>{x.success("删除成功"),f()})})},b=v([]),k=v(null),o=Z({name:"",phone:"",book_name:"",status:"",ISBN:""}),f=()=>{_.value=!0,H({pageNum:l.currentPage,pageSize:l.pageSize,name:o.name||void 0,phone:o.phone||void 0,book_name:o.book_name||void 0,ISBN:o.ISBN||void 0,status:o.status||void 0}).then(({data:r})=>{l.total=r.total,b.value=r.list}).catch(()=>{b.value=[]}).finally(()=>{_.value=!1})},S=()=>{l.currentPage===1?f():l.currentPage=1},T=()=>{var r;(r=k.value)==null||r.resetFields(),S()},M=r=>{O({ser_num:r.ser_num,back_date:K().format("YYYY-MM-DD HH:mm:ss"),status:2}).then(()=>{x.success("归还成功"),f()})};return ee([()=>l.currentPage,()=>l.pageSize],f,{immediate:!0}),(r,d)=>{const g=n("el-input"),u=n("el-form-item"),y=n("el-option"),E=n("el-select"),h=n("el-button"),F=n("el-form"),V=n("el-card"),i=n("el-table-column"),C=n("el-tag"),Y=n("el-popconfirm"),A=n("el-table"),R=n("el-pagination"),B=N("loading"),$=N("permission");return c(),ae("div",oe,[w((c(),m(V,{shadow:"never",class:"search-wrapper"},{default:a(()=>[e(F,{ref_key:"searchFormRef",ref:k,inline:!0,model:o},{default:a(()=>[e(u,{prop:"name",label:"借阅人姓名"},{default:a(()=>[e(g,{modelValue:o.name,"onUpdate:modelValue":d[0]||(d[0]=t=>o.name=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"phone",label:"借阅人手机号"},{default:a(()=>[e(g,{modelValue:o.phone,"onUpdate:modelValue":d[1]||(d[1]=t=>o.phone=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"book_name",label:"书名"},{default:a(()=>[e(g,{modelValue:o.book_name,"onUpdate:modelValue":d[2]||(d[2]=t=>o.book_name=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"ISBN",label:"ISBN"},{default:a(()=>[e(g,{modelValue:o.ISBN,"onUpdate:modelValue":d[3]||(d[3]=t=>o.ISBN=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"status",label:"状态"},{default:a(()=>[e(E,{modelValue:o.status,"onUpdate:modelValue":d[4]||(d[4]=t=>o.status=t),style:{width:"220px"},placeholder:"请选择",clearable:""},{default:a(()=>[e(y,{label:"未还",value:1}),e(y,{label:"已还",value:2})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(h,{type:"primary",icon:s(Q),onClick:S},{default:a(()=>[p("查询")]),_:1},8,["icon"]),e(h,{icon:s(G),onClick:T},{default:a(()=>[p("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[B,_.value]]),w((c(),m(V,{shadow:"never"},{default:a(()=>[D("div",le,[e(A,{data:b.value},{default:a(()=>[e(i,{prop:"name",fixed:"",label:"借阅人姓名",width:"150"}),e(i,{prop:"phone",label:"借阅人手机号",width:"150"}),e(i,{prop:"book_name","show-overflow-tooltip":"",label:"书名",width:"150"}),e(i,{prop:"ISBN",label:"ISBN",width:"200"}),e(i,{prop:"expire",label:"状态",width:"150"},{default:a(t=>[t.row.status===1?(c(),m(C,{key:0,type:"danger",effect:"dark"},{default:a(()=>[p(" 未还 ")]),_:1})):(c(),m(C,{key:1,type:"success",effect:"dark"},{default:a(()=>[p(" 已还 ")]),_:1}))]),_:1}),e(i,{prop:"lend_date",label:"借出时间","min-width":"200"},{default:a(t=>[p(I(s(z)(t.row.lend_date)),1)]),_:1}),e(i,{prop:"borrower",label:"借阅操作人",width:"150"}),e(i,{prop:"back_date",label:"归还时间","min-width":"200"},{default:a(t=>[p(I(t.row.back_date?s(z)(t.row.back_date):""),1)]),_:1}),e(i,{prop:"reverter",label:"归还操作人",width:"150"}),e(i,{fixed:"right",label:"操作",width:"150",align:"center"},{default:a(t=>[e(Y,{title:"确定归还?",onConfirm:q=>M(t.row)},{reference:a(()=>[e(h,{type:"primary",disabled:t.row.status===2,text:"",bg:"",size:"small"},{default:a(()=>[p("归还")]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm"]),w((c(),m(h,{type:"danger",text:"",bg:"",size:"small",onClick:q=>L(t.row)},{default:a(()=>[p("删除")]),_:2},1032,["onClick"])),[[$,["admin"]]])]),_:1})]),_:1},8,["data"])]),D("div",ne,[e(R,{background:"",layout:s(l).layout,"page-sizes":s(l).pageSizes,total:s(l).total,"page-size":s(l).pageSize,currentPage:s(l).currentPage,onSizeChange:s(U),onCurrentChange:s(P)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[B,_.value]])])}}}),fe=te(re,[["__scopeId","data-v-9bc6bffd"]]);export{fe as default};

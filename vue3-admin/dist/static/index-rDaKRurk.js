import{g as X,c as Y,u as Z,d as ee}from"./index-CSaWMEI_.js";import{n as w,y as ae,r as le,z as te,A as oe,E as T,B as ne}from"./element-Cx1u8HIB.js";import{u as se}from"./usePagination-DQcWKUV1.js";import{f as U}from"./index-DPHaodem.js";import{m as re,r as m,_ as ie,d as ue,ai as r,aq as F,p as C,q as ce,Q as V,O as x,P as a,V as e,u as n,T as u,t as v,U as R,S as de}from"./vue-BoURs06I.js";import{_ as pe}from"./index-Bd4y8G8I.js";import"./vxe-OnfnC8YF.js";const me={class:"app-container"},_e={class:"toolbar-wrapper"},fe={class:"table-wrapper"},ge={class:"pager-wrapper"},ve=re({name:"book_class",__name:"index",setup(he){const d=m(!1),{paginationData:s,handleCurrentChange:E,handleSizeChange:N}=se(),z={class_id:void 0,class_name:"",sort:1e3},p=m(!1),k=m(null),i=m(w(z)),$={class_name:[{required:!0,trigger:"blur",message:"请输入分类名称"}],sort:[{required:!0,trigger:"blur",message:"请输入排序"}]},q=()=>{var l;(l=k.value)==null||l.validate((o,b)=>{if(!o)return console.log("表单校验不通过",b);d.value=!0,(i.value.class_id===void 0?Y:Z)(i.value).then(()=>{T.success("操作成功"),p.value=!1,_()}).finally(()=>{d.value=!1})})},M=()=>{var l;(l=k.value)==null||l.clearValidate(),i.value=w(z)},O=l=>{ne.confirm(`正在删除分类：${l.class_name}，确认删除？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ee(l.class_id).then(()=>{T.success("删除成功"),_()})})},I=l=>{p.value=!0,i.value=w(l)},y=m([]),D=m(null),h=ie({class_name:""}),_=()=>{d.value=!0,X({pageNum:s.currentPage,pageSize:s.pageSize,class_name:h.class_name||void 0}).then(({data:l})=>{s.total=l.total,y.value=l.list}).catch(()=>{y.value=[]}).finally(()=>{d.value=!1})},B=()=>{s.currentPage===1?_():s.currentPage=1},L=()=>{var l;(l=D.value)==null||l.resetFields(),B()};return ue([()=>s.currentPage,()=>s.pageSize],_,{immediate:!0}),(l,o)=>{const b=r("el-input"),f=r("el-form-item"),c=r("el-button"),S=r("el-form"),P=r("el-card"),Q=r("el-tooltip"),g=r("el-table-column"),j=r("el-table"),G=r("el-pagination"),H=r("el-input-number"),J=r("el-dialog"),A=F("loading"),K=F("permission");return C(),ce("div",me,[V((C(),x(P,{shadow:"never",class:"search-wrapper"},{default:a(()=>[e(S,{ref_key:"searchFormRef",ref:D,inline:!0,model:h},{default:a(()=>[e(f,{prop:"class_name",label:"分类名称"},{default:a(()=>[e(b,{modelValue:h.class_name,"onUpdate:modelValue":o[0]||(o[0]=t=>h.class_name=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(f,null,{default:a(()=>[e(c,{type:"primary",icon:n(ae),onClick:B},{default:a(()=>[u("查询")]),_:1},8,["icon"]),e(c,{icon:n(le),onClick:L},{default:a(()=>[u("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[A,d.value]]),V((C(),x(P,{shadow:"never"},{default:a(()=>[v("div",_e,[v("div",null,[e(c,{type:"primary",icon:n(te),onClick:o[1]||(o[1]=t=>p.value=!0)},{default:a(()=>[u("新增分类")]),_:1},8,["icon"])]),v("div",null,[e(Q,{content:"刷新当前页"},{default:a(()=>[e(c,{type:"primary",icon:n(oe),circle:"",onClick:_},null,8,["icon"])]),_:1})])]),v("div",fe,[e(j,{data:y.value},{default:a(()=>[e(g,{prop:"class_name",label:"分类名称"}),e(g,{prop:"sort",label:"排序"}),e(g,{prop:"create_time",label:"创建时间"},{default:a(t=>[u(R(n(U)(t.row.create_time)),1)]),_:1}),e(g,{prop:"update_time",label:"更新时间"},{default:a(t=>[u(R(n(U)(t.row.update_time)),1)]),_:1}),e(g,{fixed:"right",label:"操作",width:"150",align:"center"},{default:a(t=>[e(c,{type:"primary",text:"",bg:"",size:"small",onClick:W=>I(t.row)},{default:a(()=>[u("修改")]),_:2},1032,["onClick"]),t.row.class_id!==1?V((C(),x(c,{key:0,type:"danger",text:"",bg:"",size:"small",onClick:W=>O(t.row)},{default:a(()=>[u("删除")]),_:2},1032,["onClick"])),[[K,["admin"]]]):de("",!0)]),_:1})]),_:1},8,["data"])]),v("div",ge,[e(G,{background:"",layout:n(s).layout,"page-sizes":n(s).pageSizes,total:n(s).total,"page-size":n(s).pageSize,currentPage:n(s).currentPage,onSizeChange:n(N),onCurrentChange:n(E)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[A,d.value]]),e(J,{modelValue:p.value,"onUpdate:modelValue":o[5]||(o[5]=t=>p.value=t),title:i.value.class_id===void 0?"新增分类":"修改分类",onClosed:M,width:"30%"},{footer:a(()=>[e(c,{onClick:o[4]||(o[4]=t=>p.value=!1)},{default:a(()=>[u("取消")]),_:1}),e(c,{type:"primary",onClick:q,loading:d.value},{default:a(()=>[u("确认")]),_:1},8,["loading"])]),default:a(()=>[e(S,{ref_key:"formRef",ref:k,model:i.value,rules:$,"label-width":"100px","label-position":"left"},{default:a(()=>[e(f,{prop:"class_name",label:"分类名称"},{default:a(()=>[e(b,{modelValue:i.value.class_name,"onUpdate:modelValue":o[2]||(o[2]=t=>i.value.class_name=t),maxlength:"10","show-word-limit":"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(f,{prop:"sort",label:"排序"},{default:a(()=>[e(H,{modelValue:i.value.sort,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value.sort=t),min:1,max:1e3,placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ze=pe(ve,[["__scopeId","data-v-c1321f65"]]);export{ze as default};
